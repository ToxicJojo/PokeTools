//Syntax: GroupName:goesIn1.goesIn2
var eggGroupGen3 = new Array(
		"Monster:Grass.Dragon.Water1.Field",
		"Water1:Monster.Field.Dragon.Water3.Fairy.Water2.Grass.Bug.Flying",
		"Water2:Dragon.Water1.Field",
		"Water3:Water1.Flying",
		"Bug:Grass.Water1.Humanlike",
		"Flying:Field.Fairy.Water1.Dragon.Water3",
		"Field:Dragon.Fairy.Monster.Water1.Grass.Water2.Humanlike.Flying",
		"Fairy:Field.Flying.Water1.Grass.Amorphous.Mineral",
		"Grass:Monster.Bug.Fairy.Water1.Field.Humanlike",
		"Humanlike:Bug.Grass.Field",
		"Mineral:Fairy",
		"Amorphous:Fairy",
		"Dragon:Monster.Field.Water1.Water2.Flying");

var comboPokemonGen3 = new Array(
		// Monster
		"Monster/Grass:Bulbasaur.Chikorita.Tropius",
		"Monster/Dragon:Charmander.Treecko",
		"Monster/Water1:Squirtle.Slowpoke.Lapras.Totodile.Mudkip",
		"Monster/Field:Nidoran(m/f).Rhyhorn.Mareep.Whismur"
		// Water1
		,
		"Water1/Field:Psyduck.Seel.Wooper.Delibird.Spheal",
		"Water1/Dragon:Horsea.Dratini.Feebas",
		"Water1/Water3:Omanyte.Kabuto.Corsola.Corphish",
		"Water1/Fairy:Marill",
		"Water1/Water2:Remoraid.Relicanth",
		"Water1/Grass:Lotad.Ludicolo", 
		"Water1/Bug:Surskit",
		"Water1/Flying:Wingull"
		// Water2
		, "Water2/Dragon:Magikarp", 
		"Water2/Field:Wailmer"
		// Bug
		,"Bug/Grass:Paras",
		"Bug/Humanlike:Volbeat"
		// Flying
		, "Flying/Field:Farfetch'd",
		"Flying/Fairy:Togetic",
		"Flying/Dragon:Swablu.Altaria",
		// Field
		"Field/Dragon:Ekans.Seviper",
		"Field/Fairy:Pikachu.Snubbull.Skitty.Mawile",
		"Field/Grass:Seedot",
		"Field/Humanlike:Spinda"
		// Fairy
		,"Fairy/Amorphous:Castform", 
		"Fairy/Mineral:Snorunt",
		"Fairy/Grass:Hoppip.Roselia"
		// Grass
		, "Grass/Humanlike:Cacnea" );



var eggGroupGen4 = new Array(
		"Monster:Grass.Dragon.Water1.Field",
		"Water1:Monster.Field.Dragon.Water3.Fairy.Water2.Grass.Bug.Flying.Amorphous",
		"Water2:Dragon.Water1.Field",
		"Water3:Water1.Bug.Flying",
		"Bug:Grass.Water1.Humanlike.Water3",
		"Flying:Field.Fairy.Water1.Dragon.Water3",
		"Field:Dragon.Fairy.Monster.Water1.Grass.Water2.Humanlike.Flying",
		"Fairy:Field.Flying.Water1.Grass.Amorphous.Mineral",
		"Grass:Monster.Bug.Fairy.Water1.Field.Humanlike",
		"Humanlike:Bug.Grass.Field",
		"Mineral:Fairy",
		"Amorphous:Fairy.Water1",
		"Dragon:Monster.Field.Water1.Water2.Flying");

var comboPokemonGen4 = new Array(
		// Monster
		"Monster/Grass:Bulbasaur.Chikorita.Tropius.Turtwig.Snover",
		"Monster/Dragon:Charmander.Treecko.Gible.Axew.Druddigon",
		"Monster/Water1:Squirtle.Slowpoke.Lapras.Totodile.Mudkip",
		"Monster/Field:Nidoran(m/f).Rhyhorn.Mareep.Whismur"
		// Water1
		,
		"Water1/Field:Psyduck.Seel.Wooper.Delibird.Spheal.Piplup.Bidoof.Buizel",
		"Water1/Dragon:Horsea.Dratini.Feebas",
		"Water1/Water3:Omanyte.Kabuto.Corsola.Corphish.Tirtouga",
		"Water1/Fairy:Marill.Phione",
		"Water1/Water2:Remoraid.Relicanth.Alomomola",
		"Water1/Grass:Lotad.Ludicolo", "Water1/Bug:Surskit",
		"Water1/Flying:Wingull", "Water1/Amorphous:Shellos.Stunfisk"
		// Water2
		, "Water2/Dragon:Magikarp", 
		"Water2/Field:Wailmer"
		// Water3
		, "Water3/Bug:Skorupi.Drapion"
		// Bug
		, "Bug/Grass:Paras",
		"Bug/Humanlike:Volbeat"
		// Flying
		, "Flying/Field:Farfetch'd",
		"Flying/Fairy:Togetic.Togekiss",
		"Flying/Dragon:Swablu.Altaria",
		// Field
		"Field/Dragon:Ekans.Seviper",
		"Field/Fairy:Pikachu.Snubbull.Skitty.Mawile.Pachirisu",
		"Field/Grass:Seedot",
		"Field/Humanlike:Spinda.Chimchar.Buneary.Lucario"
		// Fairy
		, "Fairy/Amorphous:Castform", 
		"Fairy/Mineral:Snorunt.Froslass",
		"Fairy/Grass:Hoppip.Shroomish.Roselia.Cherubi"
		// Grass
		, "Grass/Humanlike:Cacnea" );

var eggGroupGen5 = new Array(
		"Monster:Grass.Dragon.Water1.Field",
		"Water1:Monster.Field.Dragon.Water3.Fairy.Water2.Grass.Bug.Flying.Amorphous",
		"Water2:Dragon.Water1.Field", "Water3:Water1.Bug.Flying",
		"Bug:Grass.Water1.Humanlike.Water3.Mineral",
		"Flying:Field.Fairy.Water1.Dragon.Water3",
		"Field:Dragon.Fairy.Monster.Water1.Grass.Water2.Humanlike.Flying",
		"Fairy:Field.Flying.Water1.Grass.Amorphous.Mineral",
		"Grass:Monster.Bug.Fairy.Water1.Field.Humanlike.Mineral",
		"Humanlike:Bug.Grass.Field", "Mineral:Fairy.Bug.Amorphous.Grass",
		"Amorphous:Fairy.Water1.Mineral",
		"Dragon:Monster.Field.Water1.Water2.Flying");

var comboPokemonGen5 =  new Array(
		// Monster
		"Monster/Grass:Bulbasaur.Chikorita.Tropius.Turtwig.Snover",
		"Monster/Dragon:Charmander.Treecko.Gible.Axew.Druddigon",
		"Monster/Water1:Squirtle.Slowpoke.Lapras.Totodile.Mudkip",
		"Monster/Field:Nidoran(m/f).Rhyhorn.Mareep.Whismur"
		// Water1
		,
		"Water1/Field:Psyduck.Seel.Wooper.Delibird.Spheal.Piplup.Bidoof.Buizel",
		"Water1/Dragon:Horsea.Dratini.Feebas",
		"Water1/Water3:Omanyte.Kabuto.Corsola.Corphish.Tirtouga",
		"Water1/Fairy:Marill.Phione",
		"Water1/Water2:Remoraid.Relicanth.Alomomola",
		"Water1/Grass:Lotad.Ludicolo", 
		"Water1/Bug:Surskit",
		"Water1/Flying:Ducklett.Wingull",
		"Water1/Amorphous:Shellos.Stunfisk"
		// Water2
		, "Water2/Dragon:Magikarp",
		"Water2/Field:Wailmer"
		// Water3
		, "Water3/Bug:Skorupi.Drapion", 
		"Water3/Flying:Archen"
		// Bug
		, "Bug/Grass:Paras", "Bug/Humanlike:Volbeat", "Bug/Mineral:Dwebble"
		// Flying
		, "Flying/Field:Farfetch'd.Woobat",
		"Flying/Fairy:Togetic.Togekiss",
		"Flying/Dragon:Swablu.Altaria"
		// Field
		, "Field/Dragon:Ekans.Seviper.Scraggy",
		"Field/Fairy:Pikachu.Snubbull.Skitty.Mawile.Pachirisu",
		"Field/Grass:Seedot.Snivy",
		"Field/Humanlike:Spinda.Chimchar.Buneary.Mienfoo.Lucario"
		// Fairy
		, "Fairy/Amorphous:Castform", 
		"Fairy/Mineral:Snorunt.Froslass",
		"Fairy/Grass:Hoppip.Shroomish.Roselia.Cherubi.Cottonee"
		// Grass
		, "Grass/Humanlike:Cacnea", 
		"Grass/Mineral:Ferroseed"
		// Mineral
		, "Mineral/Amorphous:Yamask.Cofagrigus");

// Loading the comboboxes
for ( var i = 0; i < eggGroupGen5.length; i++) {
	var name = getGroupName(eggGroupGen5[i]);
	document.getElementById("startGroup").innerHTML += "<option value='" + name
			+ "'>" + name + "</select>";
}

for ( var i = 0; i < eggGroupGen5.length; i++) {
	var name = getGroupName(eggGroupGen5[i]);
	document.getElementById("goalGroup").innerHTML += "<option value='" + name
			+ "'>" + name + "</select>";
}

// Utility makes everything easier


var gen = 5;

function changeGen(){
	gen = parseFloat(document.getElementById("gen").value);
}


function getGroupName(group) {
	return group.split(":")[0];
}

function getGroup(pName) {	
	var eggGroup = "";
	if(gen == 5){
		eggGroup = eggGroupGen5;
	}else if(gen == 4){
		eggGroup = eggGroupGen4;
	}else if(gen == 3){
		eggGroup = eggGroupGen3;
	}
		
	for ( var i = 0; i < eggGroup.length; i++) {
		var name = getGroupName(eggGroup[i]);
		if (pName == name) {
			return eggGroup[i];
		}
	}
}

function getComboPokemon(pGroup1Name, pGroup2Name) {

	var comboGroup = "";
	if(gen == 5){
		comboGroup = comboPokemonGen5;
	}else if(gen == 4){
		comboGroup = comboPokemonGen4;
	}else if(gen == 3){
		comboGroup = comboPokemonGen3;
	}
	
	for ( var i = 0; i < comboGroup.length; i++) {
		var group1 = comboGroup[i].split(":")[0].split("/")[0];
		var group2 = comboGroup[i].split(":")[0].split("/")[1];

		if ((group1 == pGroup1Name && group2 == pGroup2Name)
				|| (group1 == pGroup2Name && group2 == pGroup1Name)) {
			return comboGroup[i].split(":")[1].split(".");
		}
	}
}

function showError() {
	document.getElementById("errorDiv").innerHTML = '<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button><strong>Your start and goal Egg group can´t be the same.</strong></div>';
}

var path = "";
var steps = 0;

function findPath() {

	var startGroup = getGroup(document.getElementById("startGroup").value);
	var goalGroup = getGroup(document.getElementById("goalGroup").value);

	if (startGroup == goalGroup) {
		showError();
	} else {
		steps = 0;
		path = "";
		document.getElementById("pathDiv").innerHTML = "";

		var i = 0;

		while (i != 5) {
			path = "";
			if (isConnectedOverSteps(startGroup, goalGroup, i)) {
				break;
			}
			i++;
		}

		document.getElementById("resultDiv").hidden = false;
		document.getElementById("numberSteps").innerHTML = (i + 1);

		var pathSplit = path.split(".");

		for ( var i = 0; i < pathSplit.length - 1; i++) {
			writePath(pathSplit[i], pathSplit[i + 1]);
		}

	}
}

function writePath(from, to) {

	var comboPokemon = getComboPokemon(from, to);

	var addToDiv = "<p>" + from + " + " + to + " (";

	for ( var i = 0; i < comboPokemon.length; i++) {
		addToDiv += " " + comboPokemon[i];
		if (i + 1 != comboPokemon.length) {
			addToDiv += ",";
		}
	}

	addToDiv += " )</p>";
	addToDiv += "<p> -> " + to + "</p>";

	document.getElementById("pathDiv").innerHTML += addToDiv;
}

function isConnectedOverSteps(startGroup, goalGroup, n) {
	var tPath = path;
	path += getGroupName(startGroup) + ".";
	if (n == 0) {
		if (isNext(startGroup, goalGroup)) {
			path += getGroupName(goalGroup);
			return true;
		}
	} else {
		var nextGroups = startGroup.split(":")[1].split(".");

		for ( var i = 0; i < nextGroups.length; i++) {
			var nextGroup = getGroup(nextGroups[i]);
			var newN = n - 1;
			if (isConnectedOverSteps(nextGroup, goalGroup, newN)) {
				return true;
			}
		}
	}
	path = tPath;
	return false;
}

function isNext(startGroup, goalGroup) {
	var goalName = getGroupName(goalGroup);

	var nextGroups = startGroup.split(":")[1].split(".");

	for ( var i = 0; i < nextGroups.length; i++) {
		var name = getGroupName(nextGroups[i]);
		if (goalName == name) {
			return true;
		}
	}
	return false;
}